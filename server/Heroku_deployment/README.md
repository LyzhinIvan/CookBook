Author: ms_lilibeth (Елизавета Шульга)
Date: 25.10.2016
Инструкции по развертыванию серверной части на Heroku
====================================

- Берем содержимое папки server, копируем в отдельную папку не внутри проекта локально. Heroku предполагает что развертываемый проект лежит в корне. Если оставить это все в поддиректории, как лежит у нас сейчас в репозитории, то развертывание упадет, т.к. он будет ругаться на лишние файлы.
- Поместите файлы runtime.txt, Procfile и requirements.txt в корень проекта.
- Закомментируйте строку "app.listen(8888)" в server.py и раскомментируйте сроку "app.listen(int(os.environ['PORT']))" (соответствующие пометки есть в коде). На этом облаке система помещает номер выделенного порта в переменную окружения $PORT, другие порты недоступны.

runtime.txt
---------------
Здесь прописывается версия питоновского интерпретатора. Доступны два варианта: python-3.5.2 и python-2.7.12. Мы работаем на 3-м питоне.

requirements.txt
-----------------------
Стандартный для pip3 документ. Прописываются все библиотеки, которые использует наш проект. Они будут установлены автоматически.
[Ссылка на документацию pip3](https://pip.pypa.io/en/stable/user_guide/#requirements-files)

Procfile
----------
Здесь прописывается команда, которой будет запускаться наша программа. Сейчас она имеет вид
```web: python3 server.py```
web - это тип процесса.  Это ключевое слово означает, что наша программа будет присоединена к стеку маршрутизации HTTP <i>(attached to the HTTP routing stack - возможно, я это неверно перевела)</i>

Процесс развертывания
----------------------------------
Все необходимое для развертывания у меня лежит в отдельной папке (я назвала ее cookbook-server-only). Heroku предполагает что развертываемый проект лежит в корне. Если оставить это все в поддиректории, как лежит у нас сейчас в репозитории, то развертывание упадет, т.к. он будет ругаться на лишние файлы.

### Развертывание с нуля ###
1. Поместить все необходимые файлы конфигурации в корень проекта (см. выше)
2. Установить Heroku Command Line Interface ([Ссылка на guide](https://devcenter.heroku.com/articles/getting-started-with-python#set-up))
3. Залогиниться: ```heroku login```
4. Если приложение еще не создано через личный кабинет на сайте, создать его через командную строку (это удобнее, с первым вариантом у меня почему-то возникли проблемы): ```heroku create app-name``` , где app-name - имя приложения (сейчас это cookbook-rest). Если не указывать имя приложения, оно будет автоматически сгенерировано (и, соответственно, малочитаемо)
5. При создании приложения git remote должен уже быть добавлен. Если по какой-то причине он не прописан, пишем: ```heroku git:remote -a app-name```

### После всех плясок с бубном... ###

+ Делаем самый обычный коммит: ```git commit -m "Commit message"```
+ Заливаем на сервер: ```git push heroku master```
+ Обращаем внимание на результаты развертывания
+ Если все удачно развернулось, запускаем: ```heroku ps:scale web=1``` Эта команда означает "запусти один экземпляр моего приложения". Если не ошибаюсь, в бесплатной версии можно запустить как раз-таки единственный поток, так что беспокоиться о том, что они дублируются, не надо. Есть еще команда ```heroku run```, в чем ее фишка и отличие, я еще не разобралась. Guide говорит использовать первую.
+ Смотрим логи через личный кабинет или с помощью ```heroku logs --tail``` (первый вариант для меня оказался удобнее)
+ Если все запустилось, смотрим, что получилось: ```heroku open```
 
 <b>(sic!)</b> Heroku игнорирует все ветки, за исключением master. Чтобы залить содержимое локальной ветки в master на облаке, используйте команду ```git push heroku yourbranch:master```

Ссылки
----------
[Ссылка на Getting started на сайте Heroku](https://devcenter.heroku.com/articles/getting-started-with-python#introduction)

[Ссылка на reference(справочник) на сайте Heroku](https://devcenter.heroku.com/articles/python-support#activation)

[Heroku и Git](https://devcenter.heroku.com/articles/git#tracking-your-app-in-git)




-----------------------------------
> Written with [StackEdit](https://stackedit.io/).
